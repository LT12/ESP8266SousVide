<!DOCTYPE html><html lang=en><meta charset=UTF-8><meta content="width=device-width,initial-scale=1"name=viewport><title>ESP8266 PID Temp. Controller</title><link href=https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css rel=stylesheet><script src=https://code.jquery.com/jquery-1.11.3.min.js></script><script src=https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js></script><script src=https://www.gstatic.com/charts/loader.js></script><script>function drawVisualization(){wrapper=new google.visualization.ChartWrapper({chartType:"LineChart",options:{title:"Temperature Monitor",hAxis:{title:"Time (min)"},vAxes:{0:{title:"Temp (°C)"},1:{title:"Output (%)",format:"#%",viewWindowMode:"explicit",viewWindow:{max:1,min:0}}},series:{0:{targetAxisIndex:0},1:{targetAxisIndex:1},2:{targetAxisIndex:0}},crosshair:{trigger:"both"}},containerId:"curve_chart"});var t=new google.visualization.DataTable;t.addColumn("number","Time"),t.addColumn("number","Temp."),t.addColumn("number","Output"),t.addColumn("number","Target"),wrapper.setDataTable(t),main()}function getNewData(){turned_on&&$.getJSON("/data",function(t){$("#curtemp").text(t.temp),$("#targtemp").text(t.targ),$("#elaptime").text(new Date(t.time).toISOString().substr(11,8)),timer_status&&$("#timertime").text(new Date(t.timer-t.time).toISOString().substr(11,8)),wrapper.getDataTable().addRow([t.time/6e4,t.temp,t.out/4095,t.targ]),wrapper.getDataTable().getNumberOfRows()>1e3&&wrapper.getDataTable().removeRow(0),wrapper.draw()})}function getStatus(){$.getJSON("/status",function(t){turned_on=t.status,timer_status=t.timer,$("#curP").text(t.Kp),$("#curI").text(t.Ki),$("#curD").text(t.Kd),$("#tuning").text(t.tuning),turned_on?($("#curvals").show(),$("#control").show()):($("#curvals").hide(),$("#control").hide())})}function main(){turned_on=!1,getStatus(),$("#off_button").click(function(){$.get("/control?off=0",getStatus)}),$("#on_button").click(function(){$.get("/control?on=0",getStatus)}),$("#autotune").click(function(){$.get("/control?autotune=1",getStatus)}),$("#tempform").submit(function(t){t.preventDefault(),isNaN($("#ttemp_input").val())?alert("Input must be a number"):$.get("/control","temp="+$("#ttemp_input").val())}),$("#timerform").submit(function(t){t.preventDefault(),Number.isInteger($("#timerset").val())?alert("Input must be an integer"):($.get("/control","timer="+Math.round(60*$("#timerset").val()*1e3)),getStatus())}),$("#pform").submit(function(t){t.preventDefault(),isNaN($("#pset").val())?alert("Input must be a number"):($.get("/control","P="+$("#pset").val()),getStatus())}),$("#iform").submit(function(t){t.preventDefault(),isNaN($("#iset").val())?alert("Input must be a number"):($.get("/control","I="+$("#iset").val()),getStatus())}),$("#dform").submit(function(t){t.preventDefault(),isNaN($("#dset").val())?alert("Input must be a number"):($.get("/control","D="+$("#dset").val()),getStatus())}),setInterval(getNewData,update_rate),setInterval(getStatus(),5*update_rate)}var wrapper,turned_on,timer_status,update_rate=2e3;$(document).ready(function(){$("#curvals").hide(),$("#control").hide()}),google.charts.load("current"),google.charts.setOnLoadCallback(drawVisualization)</script><div data-role=page><div class=ui-content data-role=main><div id=curve_chart style=width:100%;min-height:400px></div><div id=curvals><div class=ui-grid-a><div class=ui-block-a>Current Temperature: <span id=curtemp></span><br>Target Temperature: <span id=targtemp></span></div><div class=ui-block-b>Elapsed Time: <span id=elaptime></span><br>Time Left: <span id=timertime></span></div></div></div><div class=ui-grid-a><div class=ui-block-a><input id=on_button type=button value="Turn On"></div><div class=ui-block-b><input id=off_button type=button value="Turn Off"></div></div><div id=control><form data-ajax=false id=tempform><div class=ui-field-contain><label for=ttemp_input>Target Temp.:</label><input id=ttemp_input name=ttemp_input placeholder="Target Temp...."></div></form><form data-ajax=false id=timerform><div class=ui-field-contain><label for=timerset>Set Timer.:</label><input id=timerset name=timerset placeholder="Set Timer (min)...."></div></form><h3>Tuning Parameters:</h3><br><div class=ui-grid-b><div class=ui-block-a><form data-ajax=false id=pform><div class=ui-field-contain><label for=pset>P :</label><input id=pset name=pset></div></form></div><div class=ui-block-b><form data-ajax=false id=iform><div class=ui-field-contain><label for=iset>I :</label><input id=iset name=iset></div></form></div><div class=ui-block-c><form data-ajax=false id=dform><div class=ui-field-contain><label for=dset>D :</label><input id=dset name=dset></div></form></div></div>Current PID: <span id=curP></span>,<span id=curI></span>,<span id=curD></span><br>Tuning:<span id=tuning></span><br><input id=autotune type=button value="PID Autotune"></div></div></div>